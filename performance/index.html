<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>Performance - regenie</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
    <link href="../custom/style.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    
    <script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-166859683-2', 'auto');
    ga('send', 'pageview');
    </script>
    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="..">regenie</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="..">Home</a>
                    </li>
                
                
                
                    <li >
                        <a href="../overview/">Overview</a>
                    </li>
                
                
                
                    <li >
                        <a href="../install/">Install</a>
                    </li>
                
                
                
                    <li >
                        <a href="../options/">Documentation</a>
                    </li>
                
                
                
                    <li class="active">
                        <a href="./">Performance</a>
                    </li>
                
                
                
                    <li >
                        <a href="../recommendations/">UKBB Analysis</a>
                    </li>
                
                
                
                    <li >
                        <a href="../faq/">F.A.Q.</a>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fas fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../options/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../recommendations/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#performance">Performance</a></li>
            <li class="second-level"><a href="#quantitative-traits">Quantitative traits</a></li>
                
            <li class="second-level"><a href="#binary-traits">Binary traits</a></li>
                
            <li class="second-level"><a href="#timings-improvements-in-v22">Timings improvements in v2.2</a></li>
                
            <li class="second-level"><a href="#gene-based-testing">Gene-based testing</a></li>
                
                <li class="third-level"><a href="#quantitative-traits_1">Quantitative traits</a></li>
                <li class="third-level"><a href="#binary-traits_1">Binary traits</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h2 id="performance">Performance</h2>
<p>We assessed the performance of <strong>regenie</strong> against 3 other
programs for GWAS on large cohorts.</p>
<ol>
<li>BOLT-LMM <a href="https://www.nature.com/articles/ng.3190">Loh et al. (2015) Nature Genetics 47, 284–290</a> <a href="https://data.broadinstitute.org/alkesgroup/BOLT-LMM/">[Software]</a></li>
<li>SAIGE - <a href="https://www.nature.com/articles/s41588-018-0184-y">Zhou et al. (2018) Nature Genetics 50, 1335–1341</a><a href="https://github.com/weizhouUMICH/SAIGE">[Software]</a></li>
<li>fastGWA - <a href="https://www.nature.com/articles/s41588-019-0530-8">Jiang et al. (2019) Nature Genetics 51, 1749–1755</a> <a href="https://cnsgenomics.com/software/gcta/#Overview">[Software]</a></li>
</ol>
<p>Full details for all the runs are available in our <a href="https://doi.org/10.1038/s41588-021-00870-7">paper</a>.</p>
<h3 id="quantitative-traits">Quantitative traits</h3>
<p>We ran <strong>regenie</strong>, BOLT-LMM and fastGWA on 
3 quantitative phenotypes measured on white British UK Biobank participants 
(LDL, N=389,189; Body mass index [BMI], N=407,609; and Bilirubin, N=388,303) 
where testing was performed on 9.8 million imputed SNPs. </p>
<p>The Manhattan plots for all three phenotypes (see below) show good agreement between the methods 
with both <strong>regenie</strong> and BOLT-LMM resulting in stronger association signals relative to fastGWA 
at known peaks of association 
(note that in the plots, the scaling of the y-axis changes above the upper dashed line).</p>
<p><img alt="QTmanP" src="../img/ManP_exemplarQTs_WB.jpg" />
<br/><br/></p>
<p>We assessed the computational requirements of all three methods using a larger set of 50 
quantitative traits from the UK Biobank, looking at computational timings as well as
memory usage. 
For <strong>regenie</strong> and BOLT LMM, 469,336 LD-pruned SNPs were used as model SNPs when fitting the null model (step 1) and 
for fastGWA, these SNPs were used to compute the sparse GRM (timing not included).
Tests were performed on 11.4M imputed SNPs (step 2).</p>
<p><img alt="QTtime" src="../img/qtTiming.png" /></p>
<p>From the table above, <strong>regenie</strong> was 151x faster than BOLT-LMM in elapsed time for Step 1 and 11.5x faster for Step 2, 
which translated into $&gt;$30x overall speed-up in terms of elapsed time.
In addition, <strong>regenie</strong> had a maximum memory usage of 12.9 GB, which is mostly due to <strong>regenie</strong> 
only reading a small portion of the genotype data at a time, whereas BOLT-LMM required 50GB.
<strong>regenie</strong> was 2.8x faster than fastGWA, but fastGWA is very memory efficient and used only a maximum of 2GB.</p>
<h3 id="binary-traits">Binary traits</h3>
<p><strong>regenie</strong> was compared to BOLT-LMM and SAIGE on a set of four binary traits
measured on white British UK Biobank participants (coronary artery disease [CAD], N=352,063, case-control ratio=1:11; 
glaucoma, N=406,927, case-control ratio=1:52;
 colorectal cancer, N=407,746, case-control ratio=1:97;
 and thyroid cancer, N=407,746, case-control ratio=1:660)
and Step 2 testing was performed on 11.6 million imputed SNPs.
A novel and fast approximate Firth correction was used in <strong>regenie</strong> as well as a SPA correction.</p>
<p>As seen in the Manhattan plots below (note that the scaling of the y-axis changes above the upper dashed line), 
all four approaches show very good agreement for the most balanced trait (CAD; case-control ratio=1:11), 
but as the fraction of cases decreases BOLT-LMM tends to give inflated test statistics. 
However both <strong>regenie</strong> with Firth and SPA corrections, as well as SAIGE, which uses SPA correction, 
are all robust to this inflation and show similar agreement for the associations detected.</p>
<p><img alt="BTmanP" src="../img/ManP_exemplarBTs_WB.jpg" />
<br/></p>
<p>We assessed the computational requirements of <strong>regenie</strong> and SAIGE using a larger set of 50 
binary traits from the UK Biobank that have a range of different case-control ratios and distinct missing data patterns. 
469,336 LD-pruned SNPs were used as model SNPs when fitting the null model (step 1) 
and tests were performed on 11.4M imputed SNPs (step 2).
In step 1, <strong>regenie</strong> was run using LOOCV and for two traits SAIGE did not finish as it took longer than the 4-week limit. 
In step 2, the approximate Firth correction was used in <strong>regenie</strong> in addition to SPA correction.</p>
<p><img alt="BTtime" src="../img/btTiming.png" /></p>
<p>From the table above, Step 1 of <strong>regenie</strong> was about 350x faster and required only $40\%$ of the memory used by SAIGE. 
In Step 2, <strong>regenie</strong> Firth and SPA were 2x and 3x faster than SAIGE in CPU time, respectively, but were 21x and 34x 
faster than SAIGE in elapsed time, respectively, which suggests that <strong>regenie</strong> makes better use of parallelization in this step. 
Overall, <strong>regenie</strong> using Firth correction was 8x faster than SAIGE in CPU hours 
and 26.8x faster in elapsed time.</p>
<p>All runs above were done on the same computing environment (16 virtual CPU cores of 
a 2.1GHz AMD EPYC 7571 processor, 64GB of memory, and 600GB solid-state disk).</p>
<h3 id="timings-improvements-in-v22">Timings improvements in v2.2</h3>
<p>We have several changes in <strong>regenie</strong> v2.2 to improve the computational efficiency:</p>
<ul>
<li>The genotype file reading in Step 1 is now multi-threaded for all supported formats (i.e. BED, PGEN, and BGEN) and uses a faster file reading implementation for BGEN v1.2 format with 8-bit encoding. From our timings experiments below, these changes helped reduce the CPU time by 40-60% depending on the input format. </li>
</ul>
<p><img alt="Step1time" src="../img/timings_Step1.png" /></p>
<p><em>Note that we used a small number of SNPs for Step 1 in our experiments (20K) so the timing improvement will not be as high in a real Step 1 run where ~500K SNPs would be used.</em></p>
<ul>
<li>We have improved the implementation of the score tests for binary traits to reduce the number of matrix operations performed and this reduced the CPU timings by ~60% from the previous version 2.0.2.</li>
</ul>
<p><img alt="Step2time" src="../img/timings_Step2_BT.png" />
<em>Note that there is an added memory cost of ~8NKP bytes [N=#samples; K=#covariates;P=#samples] so ~800MB extra for a UKB 500K run with 10 traits &amp; 20 covariates.</em></p>
<ul>
<li>We have also made use of the sparsity of the genotype vector for rarer variants in Step 2 (more so with binary traits) and this reduced the timing in our experiments by ~20% on average.</li>
</ul>
<p><img alt="Step2SparseTime" src="../img/timings_Step2_BT_v2.2.png" /></p>
<p><em>In our experiments, common variants are defined as having MAF &gt; 5% and rare variants are defined as having MAF &lt; 1% and no correction (i.e. Firth/SPA) is used.</em></p>
<ul>
<li>We have added new options <code>--write-null-firth</code> and <code>--use-null-firth</code> to reduce the timing of Step 2 with approximate Firth when ran in parallel jobs split in smaller chunks within chromosomes. More specifically, <code>--write-null-firth</code> can be used in Step 1 to fit the null model for approximate Firth test and store the resulting estimates to file. Then in Step 2, specifying <code>--use-null-firth</code> will re-use these parameter estimates to reduce the timing of the approximate Firth null model fitting. 
<em>We thank Juha Karjalainen for suggesting this feature.</em></li>
</ul>
<p>Note: in our timings experiments, the PGEN genotype file only includes hard-calls. We ran a single trait in <strong>regenie</strong> and each setting was replicated 5 times.</p>
<h3 id="gene-based-testing">Gene-based testing</h3>
<p><strong>regenie</strong> v3.0 adds in a wide range of <a href="../overview/#step-2-gene-based-testing">gene-based tests</a>.
We have performed simulation experiments to assess the calibration of the tests with quantitative and binary traits 
using real genetic data from the UK Biobank where we randomly selected 100,000 samples obtained from the set of white British participants
(see the "Methods" section of the <a href="https://doi.org/10.1038/s41588-021-00870-7">Regenie paper</a> for details on phenotype simulation
where we set the heritability to 20%).</p>
<p>Using whole exome sequencing data, we constructed variant sets incorporating functional annotations 
(LoF and missense, where missense vairants were predicted as deleterious 
using a score based on 5 in-silico algorithms), 
as well as allele frequency thresholds focusing on rarer variation (1%, 0.1% and 0.01%).
The SKAT/ACAT tests were applied only to variant sets using a 1% or 0.01% AAF threshold and 
SBAT and BURDEN-ACAT joint tests combined all burden mask signals from the 1%, 0.1%, 0.01% and singleton thresholds.
1000 genes on even chromosomes were randonly selected and tested for association (causal variants were on odd chromosomes).
The QQ plots below show the distribution p-values for each test across the different annotation categories (ran in Regenie v3.2).</p>
<h4 id="quantitative-traits_1">Quantitative traits</h4>
<p>Using a 1% allele frequency cutoff for the SKAT/ACAT tests.
<img alt="QT_gene" src="../img/Gene_burden_QTsims.png" /></p>
<h4 id="binary-traits_1">Binary traits</h4>
<p>We simulated highly imbalanced phenotypes with a disease prevalence of 1%  (case-control ratio of 1:99)
and applied Firth/SPA correction to the tests.</p>
<p>Using a 1% allele frequency cutoff for the SKAT/ACAT tests.
<img alt="BT_gene1" src="../img/Gene_burden_BTsims_AF1pct.png" /></p>
<p>Using a 0.01% allele frequency cutoff for the SKAT/ACAT tests.
<img alt="BT_gene_001" src="../img/Gene_burden_BTsims_AF001pct.png" /></p></div>
        
        
    </div>

    <footer class="col-md-12 text-center">
        
        <hr>
        <p>
        <small>REGENIE is licensed under the <a href='https://github.com/rgcgithub/regenie/blob/master/LICENSE'>MIT license</small><br>
        
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
        </p>

        
        
    </footer>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>
    
    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>
    <script src="../search/main.js"></script>

  <script type="text/javascript"
          src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$'], ['\\(','\\)']],
processEscapes: true},
jax: ["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],
extensions: ["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js", "[Contrib]/a11y/accessibility-menu.js"],
TeX: {
extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"],
equationNumbers: {
autoNumber: "AMS"
}
}
});
  </script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>


</html>
